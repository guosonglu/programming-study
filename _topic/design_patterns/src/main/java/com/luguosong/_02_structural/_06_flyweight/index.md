---
layout: note
title: 享元（Flyweight）
nav_order: 60
parent: 结构型模式
grand_parent: 设计模式
create_time: 2023/6/8
---

# 一些概念

- `内在状态（Intrinsic State）`：存储在享元对象内部，不会随环境改变而改变的共享部分。
- `外在状态（Extrinsic State）`：随环境改变而改变的，不可以共享的状态。享元对象的外在状态必须由客户端保存，并在享元对象被创建之后，在需要使用的时候再传入到享元对象内部。一个外在状态与另一个外在状态之间是相互独立的。

# 意图

当需要创建大量重复对象时，将`重复的内部状态`和`不同的外部状态`进行分离。达到节约内存的目的。

# 结构

![](https://cdn.jsdelivr.net/gh/luguosong/images@master/blog-img/202306081118958-%E4%BA%AB%E5%8E%9F%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84%E5%9B%BE.png)

1. 享元模式只是一种优化。在应用该模式之前，你要确定程序中存在与大量类似对象同时占用内存相关的内存消耗问题，并且确保该问题无法使用其他更好的方式来解决。
2. `享元（Flyweight,内部状态）`类包含原始对象中部分能在多个对象中共享的状态。同一享元对象可在许多不同情景中使用。享元中存储的状态被称为“内在状态”。传递给享元方法的状态被称为“外在状态”。
3. `情景（Context，外部状态）`类包含原始对象中各不相同的`外在状态`。`情景(外部状态)`与`享元（内部状态）`对象组合在一起就能表示原始对象的全部状态。
4. 通常情况下，原始对象的行为会保留在享元类中。因此调用享元方法必须提供部分外在状态作为参数。但你也可将行为移动到情景类中，然后将连入的享元作为单纯的数据对象。
5. `客户端（Client）`负责计算或存储享元的外在状态。在客户端看来，享元是一种可在运行时进行配置的模板对象，具体的配置方式为向其方法中传入一些情景数据参数。
6. `享元工厂（Flyweight Factory）`会对已有享元的缓存池进行管理。有了工厂后，客户端就无需直接创建享元，它们只需调用工厂并向其传递目标享元的一些内在状态即可。工厂会根据参数在之前已创建的享元中进行查找，如果找到满足条件的享元就将其返回；如果没有找到就根据参数新建享元。

# 示例

{% highlight java %}
{% include_relative FlyweightExample.java %}
{% endhighlight %}
